document.addEventListener("DOMContentLoaded",function(){app.inicio()});var app={URL_SERVER:"https://salvacam.net78.net/horarios/index.php?parada=",conterDescripcion:document.getElementById("conter-descripcion"),cancelar:document.getElementById("cancelar"),guardar:document.getElementById("guardar"),todasParadas:[],botonConsulta:document.getElementById("botonConsulta"),cargando:document.getElementById("cargando"),botonAdd:document.getElementById("botonAdd"),operacion:document.getElementById("operacion"),hora:document.getElementById("hora"),tablaResultado:document.getElementById("tablaResultado"),cabeceraTabla:document.getElementById("cabeceraTabla").classList,botonesFavoritos:document.querySelector(".parada"),inicio:function(){app.botonConsulta.addEventListener("click",app.mostrar),app.botonAdd.addEventListener("click",app.addBookmark),localStorage.getItem("_horarios_paradas")&&(app.todasParadas=JSON.parse(localStorage.getItem("_horarios_paradas"))),app.mostrarFavoritos(),"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then(function(){})},mostrarFavorito:function(a){document.getElementById("parada").value=a.target.getAttribute("data-id"),app.mostrar()},mostrar:function(){alert("mostrar"),app.cancelAdd();var a=document.getElementById("parada").value;if(alert(a),""!==a){app.botonConsulta.classList.toggle("disabled"),app.botonConsulta.removeEventListener("click",app.mostrar),cargando.classList.toggle("hide");var e=app.URL_SERVER+a;alert(e);var t=new XMLHttpRequest;t.open("GET",e,!0),t.onreadystatechange=function(){if(4==t.readyState&&(alert(t.responseText),t.responseText)){var e=JSON.parse(t.responseText);alert(e),app.renderResult(e,a)}},t.send(null),alert(t)}},renderResult:function(a,e){if(alert("renderResult"),app.botonConsulta.classList.toggle("disabled"),app.botonConsulta.addEventListener("click",app.mostrar),app.cargando.classList.toggle("hide"),a.hasOwnProperty("error"))return operacion.textContent=a.error,!1;if(a.length<1)return operacion.textContent="No hay bus acercandose",!1;app.operacion.textContent="";var t=new Date;for(app.hora.textContent="Parada "+e+", a las "+t.getHours()+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes());app.tablaResultado.firstChild;)app.tablaResultado.removeChild(app.tablaResultado.firstChild);app.cabeceraTabla.remove("hide"),document.getElementById("resultado").className="",document.getElementById("limpiar").removeEventListener("click",function(){}),document.getElementById("limpiar").addEventListener("click",function(){document.getElementById("resultado").className="hide"}),a.forEach(function(a){var e=document.createElement("tr");for(var t in a){var r=document.createElement("td");r.textContent=a[t],e.appendChild(r)}app.tablaResultado.appendChild(e)})},addBookmark:function(){document.getElementById("parada").value;app.conterDescripcion.className="",cancelar.addEventListener("click",app.cancelAdd),guardar.addEventListener("click",app.saveAdd)},cancelAdd:function(){document.getElementById("descripcion").value="",app.conterDescripcion.className="hide"},saveAdd:function(){var a=document.getElementById("parada").value,e=document.getElementById("descripcion").value,t={Order:1,Number:a,Descripcion:e};app.todasParadas.push(t),localStorage.setItem("_horarios_paradas",JSON.stringify(app.todasParadas)),app.cancelAdd(),app.mostrarFavoritos()},deleteAdd:function(a){app.cancelAdd();var e=confirm("Borrar la parada "+a.target.getAttribute("data-id")+" - "+a.target.getAttribute("data-desc"));if(e){var t=app.todasParadas;app.todasParadas=[];for(var r in t)t[r].Number==a.target.getAttribute("data-id")&&t[r].Descripcion==a.target.getAttribute("data-desc")||app.todasParadas.push(t[r]);localStorage.setItem("_horarios_paradas",JSON.stringify(app.todasParadas)),app.mostrarFavoritos()}},editAdd:function(){app.cancelAdd()},deleteBookmark:function(){app.cancelAdd();var a=confirm("Borrar todos las paradas");a&&(localStorage.removeItem("_horarios_paradas"),app.todasParadas=[],app.mostrarFavoritos())},mostrarFavoritos:function(){for(var a=document.getElementById("lista-favoritos");a.firstChild;)a.removeChild(a.firstChild);if(app.todasParadas.forEach(function(e){var t=document.createElement("span");t.className="parada btn btn-default btn-lg",t.setAttribute("data-id",e.Number);var r=document.createTextNode(e.Number+" - \t"+e.Descripcion);t.appendChild(r),a.appendChild(t),t.addEventListener("click",app.mostrarFavorito);var o=document.createElement("i");o.className="borrar fa fa-trash-o btn btn-default fa-2x",o.setAttribute("aria-hidden",!0),o.setAttribute("data-id",e.Number),o.setAttribute("data-desc",e.Descripcion),o.addEventListener("click",app.deleteAdd),a.appendChild(o);var n=document.createElement("div");n.className="salto",a.appendChild(n)}),app.todasParadas.length>0){var e=document.createElement("i");e.className="fa fa-trash btn btn-default fa-2x btn-lg",e.setAttribute("aria-hidden",!0),e.setAttribute("id","borrar-todo"),a.appendChild(e),e.addEventListener("click",app.deleteBookmark)}}};