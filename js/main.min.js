!function(){"use strict";function t(){var t={parent:document.body,version:"1.0.11",defaultOkLabel:"Ok",okLabel:"Ok",defaultCancelLabel:"Cancel",cancelLabel:"Cancel",defaultMaxLogItems:2,maxLogItems:2,promptValue:"",promptPlaceholder:"",closeLogOnClick:!1,closeLogOnClickDefault:!1,delay:5e3,defaultDelay:5e3,logContainerClass:"alertify-logs",logContainerDefaultClass:"alertify-logs",dialogs:{buttons:{holder:"<nav>{{buttons}}</nav>",ok:"<button class='ok' tabindex='1'>{{ok}}</button>",cancel:"<button class='cancel' tabindex='2'>{{cancel}}</button>"},input:"<input type='text' maxlength='20'>",message:"<p class='msg'>{{message}}</p>",log:"<div class='{{class}}'>{{message}}</div>"},defaultDialogs:{buttons:{holder:"<nav>{{buttons}}</nav>",ok:"<button class='ok' tabindex='1'>{{ok}}</button>",cancel:"<button class='cancel' tabindex='2'>{{cancel}}</button>"},input:"<input type='text' maxlength='20'>",message:"<p class='msg'>{{message}}</p>",log:"<div class='{{class}}'>{{message}}</div>"},build:function(t){var e=this.dialogs.buttons.ok,n="<div class='dialog'><div>"+this.dialogs.message.replace("{{message}}",t.message);return"confirm"!==t.type&&"prompt"!==t.type||(e=this.dialogs.buttons.cancel+this.dialogs.buttons.ok),"prompt"===t.type&&(n+=this.dialogs.input),n=(n+this.dialogs.buttons.holder+"</div></div>").replace("{{buttons}}",e).replace("{{ok}}",this.okLabel).replace("{{cancel}}",this.cancelLabel)},setCloseLogOnClick:function(t){this.closeLogOnClick=!!t},close:function(t,n){this.closeLogOnClick&&t.addEventListener("click",function(){e(t)}),n=n&&!isNaN(+n)?+n:this.delay,n<0?e(t):n>0&&setTimeout(function(){e(t)},n)},dialog:function(t,e,n,o){return this.setup({type:e,message:t,onOkay:n,onCancel:o})},log:function(t,e,n){var o=document.querySelectorAll(".alertify-logs > div");if(o){var s=o.length-this.maxLogItems;if(s>=0)for(var i=0,a=s+1;i<a;i++)this.close(o[i],-1)}this.notify(t,e,n)},setLogPosition:function(t){this.logContainerClass="alertify-logs "+t},setupLogContainer:function(){var t=document.querySelector(".alertify-logs"),e=this.logContainerClass;return t||(t=document.createElement("div"),t.className=e,this.parent.appendChild(t)),t.className!==e&&(t.className=e),t},notify:function(e,n,o){var s=this.setupLogContainer(),i=document.createElement("div");i.className=n||"default",t.logTemplateMethod?i.innerHTML=t.logTemplateMethod(e):i.innerHTML=e,"function"==typeof o&&i.addEventListener("click",o),s.appendChild(i),setTimeout(function(){i.className+=" show"},10),this.close(i,this.delay)},setup:function(t){function n(n){"function"!=typeof n&&(n=function(){}),s&&s.addEventListener("click",function(s){t.onOkay&&"function"==typeof t.onOkay&&(a?t.onOkay(a.value,s):t.onOkay(s)),n(a?{buttonClicked:"ok",inputValue:a.value,event:s}:{buttonClicked:"ok",event:s}),e(o)}),i&&i.addEventListener("click",function(s){t.onCancel&&"function"==typeof t.onCancel&&t.onCancel(s),n({buttonClicked:"cancel",event:s}),e(o)}),a&&a.addEventListener("keyup",function(t){13===t.which&&s.click()})}var o=document.createElement("div");o.className="alertify hide",o.innerHTML=this.build(t);var s=o.querySelector(".ok"),i=o.querySelector(".cancel"),a=o.querySelector("input"),l=o.querySelector("label");a&&("string"==typeof this.promptPlaceholder&&(l?l.textContent=this.promptPlaceholder:a.placeholder=this.promptPlaceholder),"string"==typeof this.promptValue&&(a.value=this.promptValue));var c;return"function"==typeof Promise?c=new Promise(n):n(),this.parent.appendChild(o),setTimeout(function(){o.classList.remove("hide"),a&&t.type&&"prompt"===t.type?(a.select(),a.focus()):s&&s.focus()},100),c},okBtn:function(t){return this.okLabel=t,this},setDelay:function(t){return t=t||0,this.delay=isNaN(t)?this.defaultDelay:parseInt(t,10),this},cancelBtn:function(t){return this.cancelLabel=t,this},setMaxLogItems:function(t){this.maxLogItems=parseInt(t||this.defaultMaxLogItems)},theme:function(t){switch(t.toLowerCase()){case"bootstrap":this.dialogs.buttons.ok="<button class='ok btn btn-primary' tabindex='1'>{{ok}}</button>",this.dialogs.buttons.cancel="<button class='cancel btn btn-default' tabindex='2'>{{cancel}}</button>",this.dialogs.input="<input type='text' class='form-control'>";break;case"purecss":this.dialogs.buttons.ok="<button class='ok pure-button' tabindex='1'>{{ok}}</button>",this.dialogs.buttons.cancel="<button class='cancel pure-button' tabindex='2'>{{cancel}}</button>";break;case"mdl":case"material-design-light":this.dialogs.buttons.ok="<button class='ok mdl-button mdl-js-button mdl-js-ripple-effect'  tabindex='1'>{{ok}}</button>",this.dialogs.buttons.cancel="<button class='cancel mdl-button mdl-js-button mdl-js-ripple-effect' tabindex='2'>{{cancel}}</button>",this.dialogs.input="<div class='mdl-textfield mdl-js-textfield'><input class='mdl-textfield__input'><label class='md-textfield__label'></label></div>";break;case"angular-material":this.dialogs.buttons.ok="<button class='ok md-primary md-button' tabindex='1'>{{ok}}</button>",this.dialogs.buttons.cancel="<button class='cancel md-button' tabindex='2'>{{cancel}}</button>",this.dialogs.input="<div layout='column'><md-input-container md-no-float><input type='text'></md-input-container></div>";break;case"default":default:this.dialogs.buttons.ok=this.defaultDialogs.buttons.ok,this.dialogs.buttons.cancel=this.defaultDialogs.buttons.cancel,this.dialogs.input=this.defaultDialogs.input}},reset:function(){this.parent=document.body,this.theme("default"),this.okBtn(this.defaultOkLabel),this.cancelBtn(this.defaultCancelLabel),this.setMaxLogItems(),this.promptValue="",this.promptPlaceholder="",this.delay=this.defaultDelay,this.setCloseLogOnClick(this.closeLogOnClickDefault),this.setLogPosition("bottom left"),this.logTemplateMethod=null},injectCSS:function(){if(!document.querySelector("#alertifyCSS")){var t=document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",e.id="alertifyCSS",e.innerHTML="/* style.css */",t.insertBefore(e,t.firstChild)}},removeCSS:function(){var t=document.querySelector("#alertifyCSS");t&&t.parentNode&&t.parentNode.removeChild(t)}};return t.injectCSS(),{_$$alertify:t,parent:function(e){t.parent=e},reset:function(){return t.reset(),this},alert:function(e,n,o){return t.dialog(e,"alert",n,o)||this},confirm:function(e,n,o){return t.dialog(e,"confirm",n,o)||this},prompt:function(e,n,o){return t.dialog(e,"prompt",n,o)||this},log:function(e,n){return t.log(e,"default",n),this},theme:function(e){return t.theme(e),this},success:function(e,n){return t.log(e,"success",n),this},error:function(e,n){return t.log(e,"error",n),this},cancelBtn:function(e){return t.cancelBtn(e),this},okBtn:function(e){return t.okBtn(e),this},delay:function(e){return t.setDelay(e),this},placeholder:function(e){return t.promptPlaceholder=e,this},defaultValue:function(e){return t.promptValue=e,this},maxLogItems:function(e){return t.setMaxLogItems(e),this},closeLogOnClick:function(e){return t.setCloseLogOnClick(!!e),this},logPosition:function(e){return t.setLogPosition(e||""),this},setLogTemplate:function(e){return t.logTemplateMethod=e,this},clearLogs:function(){return t.setupLogContainer().innerHTML="",this},version:t.version}}var e=function(t){if(t){var e=function(){t&&t.parentNode&&t.parentNode.removeChild(t)};t.classList.remove("show"),t.classList.add("hide"),t.addEventListener("transitionend",e),setTimeout(e,500)}};if("undefined"!=typeof module&&module&&module.exports){module.exports=function(){return new t};var n=new t;for(var o in n)module.exports[o]=n[o]}else"function"==typeof define&&define.amd?define(function(){return new t}):window.alertify=new t}();
document.addEventListener("DOMContentLoaded",function(){app.inicio()});var app={URL_SERVER:"https://calcicolous-moonlig.000webhostapp.com/horarios/index.php?parada=",cancelar:document.getElementById("cancelar"),guardar:document.getElementById("guardar"),todasParadas:[],timeOuts:[],ordenNuevo:0,ordenInicio:0,tiempoAnimacion:750,notifictionEnable:!0,configradorDiv:document.getElementById("configradorDiv"),principalDiv:document.getElementById("principalDiv"),botonConsulta:document.getElementById("botonConsulta"),botonMenu:document.getElementById("botonMenu"),cargando:document.getElementById("cargando"),botonAdd:document.getElementById("botonAdd"),operacion:document.getElementById("operacion"),hora:document.getElementById("hora"),tablaResultado:document.getElementById("tablaResultado"),cabeceraTabla:document.getElementById("cabeceraTabla").classList,botonesFavoritos:document.querySelector(".parada"),infoButton:document.getElementById("infoButton"),responsibility:document.getElementById("responsibility"),notification:document.getElementById("notification"),inicio:function(){app.botonConsulta.addEventListener("click",app.mostrar),app.botonAdd.addEventListener("click",app.addBookmark),app.botonMenu.addEventListener("click",app.showMenu),app.infoButton.addEventListener("click",app.showInfo),app.configradorDiv.style.minHeight=window.innerHeight-46+"px",localStorage.getItem("_horarios_paradas")&&(app.getAllBusStopOrder(),app.mostrarFavoritos()),localStorage.getItem("_horarios_notificaciones")&&(app.notifictionEnable=JSON.parse(localStorage.getItem("_horarios_notificaciones")),app.notifictionEnable||(app.notifictionEnable=!1,app.notification.removeAttribute("checked"))),app.notification.addEventListener("change",app.updateEnableNotification),"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then(function(){})},getAllBusStopOrder:function(){function a(a,t){return a.Order<t.Order?-1:a.Order>t.Order?1:0}app.todasParadas=JSON.parse(localStorage.getItem("_horarios_paradas")),app.todasParadas.sort(a),app.ordenNuevo=app.todasParadas[app.todasParadas.length-1].Order,app.ordenInicio=app.todasParadas[0].Order},updateEnableNotification:function(){app.notification.checked?app.notifictionEnable=!0:app.notifictionEnable=!1,localStorage.setItem("_horarios_notificaciones",JSON.stringify(app.notifictionEnable))},showMenu:function(){app.botonMenu.removeEventListener("click",app.showMenu),setTimeout(function(){app.botonMenu.addEventListener("click",app.showMenu)},app.tiempoAnimacion),app.configradorDiv.classList.contains("swipe-izquierda")?(app.configradorDiv.classList.add("swipe-derecha"),app.configradorDiv.classList.remove("swipe-izquierda"),app.botonMenu.classList.add("fa-bars"),app.botonMenu.classList.remove("fa-arrow-right"),app.principalDiv.classList.remove("hide")):(app.configradorDiv.classList.remove("swipe-derecha"),app.configradorDiv.classList.add("swipe-izquierda"),app.botonMenu.classList.remove("fa-bars"),app.botonMenu.classList.add("fa-arrow-right"),app.principalDiv.classList.add("hide"))},showInfo:function(){app.responsibility.classList.contains("hidden")?(app.responsibility.classList.remove("hidden"),app.infoButton.textContent="Ocultar Información"):(app.responsibility.classList.add("hidden"),app.infoButton.textContent="Ver Información")},mostrarFavorito:function(a){document.getElementById("parada").value=a.target.getAttribute("data-id"),app.mostrar()},mostrar:function(){var a=document.getElementById("parada").value;if(""===a)return void alertify.okBtn("OK").alert("Debes introducir un número de parada");app.botonConsulta.classList.toggle("disabled"),app.botonConsulta.removeEventListener("click",app.mostrar),document.querySelector(".parada")&&(document.querySelector(".parada").classList.toggle("disabled"),document.querySelector(".parada").removeEventListener("click",app.mostrarFavorito)),app.cargando.classList.toggle("hide");var t=app.URL_SERVER+a;fetch(t).then(function(t){if(200!==t.status)return void app.fn_errorXHR();t.json().then(function(t){app.renderResult(t,a);for(var e=0;e<app.timeOuts.length;e++)clearTimeout(app.timeOuts[e]);app.timeOuts=[],t.error||t.forEach(function(t){app.timeOuts.push(setTimeout(function(){app.showNotification(t.linea,a)},60*(t.tiempo-1)*1e3))})})}).catch(function(a){app.fn_errorXHR()})},showNotification:function(a,t){app.notifictionEnable&&Notification&&("granted"!==Notification.permission&&Notification.requestPermission(),Notification.requestPermission(function(e){"granted"===e&&navigator.serviceWorker.ready.then(function(e){var r="Parada "+t,o={body:"Acercandose la linea "+a,icon:"img/icon-48x48.png",tag:"horarioBus"};e.showNotification(r,o)})}))},fn_errorXHR:function(){alertify.okBtn("OK").alert("Error al obtener los datos, compruebe su conexión"),app.botonConsulta.classList.toggle("disabled"),app.botonConsulta.addEventListener("click",app.mostrar),document.querySelector(".parada")&&(document.querySelector(".parada").classList.toggle("disabled"),document.querySelector(".parada").addEventListener("click",app.mostrarFavorito)),app.cargando.classList.toggle("hide")},renderResult:function(a,t){if(app.botonConsulta.classList.toggle("disabled"),app.botonConsulta.addEventListener("click",app.mostrar),document.querySelector(".parada")&&(document.querySelector(".parada").classList.toggle("disabled"),document.querySelector(".parada").addEventListener("click",app.mostrarFavorito)),app.cargando.classList.toggle("hide"),a.hasOwnProperty("error"))return app.operacion.textContent=a.error,!1;if(a.length<1)return app.operacion.textContent="No hay bus acercandose",!1;app.operacion.textContent="";var e=new Date;for(app.hora.textContent="Parada "+t+", a las "+e.getHours()+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());app.tablaResultado.firstChild;)app.tablaResultado.removeChild(app.tablaResultado.firstChild);app.cabeceraTabla.remove("hide"),document.getElementById("resultado").className="",document.getElementById("limpiar").removeEventListener("click",function(){}),document.getElementById("mostrar-tabla").removeEventListener("click",function(){}),document.getElementById("limpiar").addEventListener("click",function(){document.getElementById("resultado").className="hide",document.getElementById("mostrar-tabla").className=""}),document.getElementById("mostrar-tabla").addEventListener("click",function(){document.getElementById("resultado").className="",document.getElementById("mostrar-tabla").className="hide"}),a.forEach(function(a){var t=document.createElement("tr");for(var e in a){var r=document.createElement("td");r.textContent=a[e],t.appendChild(r)}app.tablaResultado.appendChild(t)})},addBookmark:function(){var a=document.getElementById("parada").value;if(!a||""===a)return void alertify.okBtn("OK").alert("Debes introducir un número de parada");for(var t in app.todasParadas)if(app.todasParadas[t].Number===a)return void alertify.okBtn("OK").alert("Ya tienes la parada "+a+' guardada con la descripción "'+app.todasParadas[t].Descripcion+'"');alertify.okBtn("Guardar").cancelBtn("Cancelar").placeholder("Descripcion de la parada").prompt("Descripcion para la parada "+a+", máximo 20 caracteres",function(t,e){if(e.preventDefault(),""===t)return void alertify.okBtn("OK").alert("Debes introducir una descripción de la parada");var r={Order:app.ordenNuevo+1,Number:a,Descripcion:t};app.todasParadas.push(r),localStorage.setItem("_horarios_paradas",JSON.stringify(app.todasParadas)),app.mostrarFavoritos()})},deleteAdd:function(a){var t=a.target.getAttribute("data-id");alertify.okBtn("Borrar").cancelBtn("Cancelar").confirm("¿Borrar la parada "+a.target.getAttribute("data-id")+" - "+a.target.getAttribute("data-desc")+"?",function(a){a.preventDefault();var e=app.todasParadas;app.todasParadas=[];for(var r in e)e[r].Number!==t&&app.todasParadas.push(e[r]);localStorage.setItem("_horarios_paradas",JSON.stringify(app.todasParadas)),app.mostrarFavoritos()})},editAdd:function(a){var t=a.target.getAttribute("data-id");alertify.defaultValue(a.target.getAttribute("data-desc")).okBtn("Editar").cancelBtn("Cancelar").prompt("Nueva descripcion para la parada "+a.target.getAttribute("data-id")+", máximo 20 caracteres",function(a,e){e.preventDefault();for(var r in app.todasParadas)app.todasParadas[r].Number===t&&(app.todasParadas[r].Descripcion=a);localStorage.setItem("_horarios_paradas",JSON.stringify(app.todasParadas)),app.mostrarFavoritos()})},deleteBookmark:function(){alertify.okBtn("Borrar").cancelBtn("Cancelar").confirm("¿Borrar todas las paradas?",function(a){a.preventDefault(),localStorage.removeItem("_horarios_paradas"),app.todasParadas=[],app.ordenNuevo=0,app.ordenInicio=0,app.mostrarFavoritos()})},upBookmark:function(a){var t=a.target.getAttribute("data-id"),e=0;for(var r in app.todasParadas){if(app.todasParadas[r].Number===t){var o=app.todasParadas[r].Order;app.todasParadas[r].Order=e,app.todasParadas[parseInt(r)-1].Order=o}e=app.todasParadas[r].Order}localStorage.setItem("_horarios_paradas",JSON.stringify(app.todasParadas)),app.mostrarFavoritos()},downBookmark:function(a){var t=a.target.getAttribute("data-id"),e=0;for(var r in app.todasParadas)if(e=app.todasParadas[r].Order,app.todasParadas[r].Number===t){var o=app.todasParadas[parseInt(r)+1].Order;app.todasParadas[parseInt(r)+1].Order=e,app.todasParadas[r].Order=o}localStorage.setItem("_horarios_paradas",JSON.stringify(app.todasParadas)),app.mostrarFavoritos()},mostrarFavoritos:function(){app.getAllBusStopOrder();for(var a=document.getElementById("lista-favoritos"),t=document.querySelector("#configradorDiv #list");a.firstChild;)a.removeChild(a.firstChild);for(;t.firstChild;)t.removeChild(t.firstChild);if(app.todasParadas.forEach(function(e){var r=document.createElement("span");r.className="parada btn btn-default btn-lg",r.setAttribute("data-id",e.Number);var o=document.createTextNode(e.Number+": "+e.Descripcion);r.appendChild(o),a.appendChild(r),r.addEventListener("click",app.mostrarFavorito);var n=document.createElement("span");n.className="parada btn btn-default btn-lg";var o=document.createTextNode(e.Number);n.appendChild(o),t.appendChild(n);var i=document.createElement("i");i.className="borrar fa fa-trash-o btn btn-default btn-lg",i.setAttribute("aria-hidden",!0),i.setAttribute("data-id",e.Number),i.setAttribute("data-desc",e.Descripcion),i.addEventListener("click",app.deleteAdd),t.appendChild(i);var d=document.createElement("i");d.className="editar fa fa-pencil btn btn-default btn-lg",d.setAttribute("aria-hidden",!0),d.setAttribute("data-id",e.Number),d.setAttribute("data-desc",e.Descripcion),d.addEventListener("click",app.editAdd),t.appendChild(d);var s=document.createElement("i");s.className="subir fa fa-long-arrow-up btn btn-default btn-lg",s.setAttribute("aria-hidden",!0),s.setAttribute("data-id",e.Number),e.Order!==app.ordenInicio?s.addEventListener("click",app.upBookmark):s.classList.add("disabled"),t.appendChild(s);var p=document.createElement("i");p.className="bajar fa fa-long-arrow-down btn btn-default btn-lg",p.setAttribute("aria-hidden",!0),p.setAttribute("data-id",e.Number),e.Order!==app.ordenNuevo?p.addEventListener("click",app.downBookmark):p.classList.add("disabled"),t.appendChild(p);var c=document.createElement("div");c.className="salto",a.appendChild(c),t.appendChild(c)}),app.todasParadas.length>0){var e=document.createElement("i");e.className="fa fa-trash btn btn-default fa-2x",e.setAttribute("aria-hidden",!0),e.setAttribute("id","borrar-todo");var r=document.createElement("span");r.textContent=" BORRAR TODAS",e.appendChild(r),t.appendChild(e),e.addEventListener("click",app.deleteBookmark)}}};